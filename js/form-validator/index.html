<html>
<head>
<!--
    Test suite for jQuery Form Validator
    ---------------------------------------
    In time all validators will be tested in this file. Simply run the
    file in the browser to see if everything seems okay. Feel free to
    add tests when adding new validators to this jQuery plugin
-->
<title>jQuery Form Validator - Tests</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="jquery.formvalidator.js"></script>
<script>

$.formUtils.loadModules('date.dev, location.dev, security.dev, sweden.dev, uk.dev');

function input(val, dataValidationAttr, elAttr) {
    if(!elAttr)
        elAttr = {};
    for(var x in dataValidationAttr) {
        if(dataValidationAttr.hasOwnProperty(x)) {
            elAttr['data-validation-'+x] = dataValidationAttr[x];
        }
    }

    elAttr['value'] = val;
    return $('<input />', elAttr);
}

var testSuites = [
    {
        validator : 'validate_url',
        tests : function() {
            return [
                {val: 'klsdmfklsmdf', isValid : false, message : 'Should clearly not be an URL'},
                {val: 'http://google.se', isValid : true},
                {val: 'https://google.se', isValid : true},
                {val: 'https://google.se/apa/arg.jsp', isValid : true},
                {val: 'https://google.se/apa/arg.jsp?arg=2&34', isValid : true},
                {val: 'https://test.google.se/apa/arg.jsp?arg[]=2&34', isValid : true},
                {val: 'www.google.se', isValid : false},
                {val: '', isValid : false}
            ];
        }
    },
    {
        validator : 'validate_email',
        tests : function() {
            return [
                {val: 'sasas@sdssds.se', isValid : true},
                {val: '', isValid : false},
                {val: 'asdsd@sdsds.se', isValid : true},
                {val: 'asdsdsd@sdsd.co.uk', isValid : true},
                {val: 'sasas@sdsd.xxx', isValid : true},
                {val: 'sasas@sdsd.xxz', isValid : false},
                {val: '@sdsd.xxz', isValid : false},
                {val: 'sasas@', isValid : false},
                {val: 'sasas.se', isValid : false},
                {val: 'sasas-sdsd.com', isValid : false}
            ];
        }
    },
    {
        validator : 'validate_domain',
        tests : function() {
            return [
                {val:'domain.xxx', isValid:true},
                {val:'domain.com', isValid:true},
                {val:'www.domain.com', isValid:true},
                {val:'http://domain.se', isValid:true},
                {val:'http://www.domain.se', isValid:true},
                {val:'http://www.domain.se/', isValid:true},
                {val:'domain.com/', isValid:true},
                {val:'', isValid:false}
            ];
        }
    },
    {
        validator : 'validate_length',
        tests : function() {
            return [
                {val:input('1234', {'length':'max3'}, {name:6}), isValid:false},
                {val:input('1234', {'length':'min3'}, {name:5}), isValid:true},
                {val:input('1234', {'length':'min5'}, {name:4}), isValid:false},
                {val:input('1234', {'length':'2-35'}, {name:3}), isValid:true},
                {val:input('123456', {'length':'2-5'}, {name:3}), isValid:false},
                {val:input('1234', {'length':'max4'}, {name:1}), isValid:true}
            ];
        }
    }
];

/* * * * * RUN TESTS * * * * */

$(function() {

    var $body = $('body');
    var numFinishedTests = 0;
    var numFailedTests = 0;
    var message = '';

    var runtTest = function(validationTest) {
        var $input;
        if(typeof validationTest.val == 'string') {
            $input = $('<input />', {type:'text',value:validationTest.val});
        }
        else {
            $input = validationTest.val;
        }

        var result = validator.validate($input.val(), $input, false, false, $('<form></form>'));
        var wasValid = result === true;

        // output
        if(wasValid != validationTest.isValid) {
            message = '<a href="#'+validator.name+'" style="color:red">'+validator.name+'</a> failed with value <em>'+
                    $input.val()+'</em> expected to be '+(validationTest.isValid ? 'valid':'invalid')+
                    ' but was '+(wasValid ? 'valid':'invalid')+
                    (validationTest.message ? ' ('+validationTest.message+')':'');

            $body.append('<p>'+message+'</p>');
            numFailedTests++;
        }
        else {
            message = '<a href="#'+validator.name+'" style="color:green">'+validator.name+'</a> successfully tested with value <em>'+
                    $input.val()+'</em> (was '+(wasValid ? 'valid':'invalid')+')';

            $body.append('<p>'+message+'</p>');
        }
        numFinishedTests++;
    };

    for(var i=0; i < testSuites.length; i++) {
        var validator = $.formUtils.validators[testSuites[i].validator];
        var tests = testSuites[i].tests();

        for(var j=0; j < tests.length; j++) {
            runtTest(tests[j]);
        }
    }

    var endMessage = '<h3>All '+numFinishedTests+' tests has finished</h3>';
    if(numFailedTests == 0) {
        endMessage += '<p>Everything was fine :)</p>';
    }
    else {
        endMessage += '<p><strong style="color:red">It\'s not perfect yet :(</strong> - '+numFailedTests+' test failed</p>';
    }

    $body.prepend('<div>'+endMessage+'<hr></div>');
});

// TODO: Write more tests...

</script>
</head>
<body></body>
</html>