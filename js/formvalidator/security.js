/**
 * jQuery Form Validator Module: Security
 * ------------------------------------------
 * Created by Victor Jonsson <http://www.victorjonsson.se>
 * Documentation and issue tracking on Github <https://github.com/victorjonsson/jQuery-Form-Validator/>
 *
 * This form validation module adds validators typically used when validating
 * user registration forms. This module add the following validators:
 *  - validate_spamcheck
 *  - validate_confirmation
 *  - validate_strength
 *  - validate_backend
 *
 * @license Dual licensed under the MIT or GPL Version 2 licenses
 * @version 1.9.1
 */(function(a){a.formUtils.addValidator({name:"validate_spamcheck",validate:function(a,b,c){var d=b.attr(c.validationRuleAttribute);return d.match(/captcha([0-9a-z]+)/i)[1].replace("captcha","")===a},errorMessage:"",errorMessageKey:"badSecurityAnswer"}),a.formUtils.addValidator({name:"validate_confirmation",validate:function(a,b,c,d,e){var f="",g=e.find("input[name="+b.attr("name")+"_confirmation]").eq(0);return g&&(f=g.val()),a===f},errorMessage:"",errorMessageKey:"notConfirmed"}),a.formUtils.addValidator({name:"validate_strength",validate:function(b,c,d){var e=c.attr(d.validationRuleAttribute),f=a.formUtils.getAttributeInteger(e,"strength");return f>2&&(f=2),a.formUtils.validators.validate_strength.calculatePasswordStrength(b)>=f},errorMessage:"",errorMessageKey:"badStrength",calculatePasswordStrength:function(a){if(a.length<4)return 0;var b=0,c=function(a,b){var c="";for(var d=0;d<b.length;d++){var e=!0;for(var f=0;f<a&&f+d+a<b.length;f++)e=e&&b.charAt(f+d)==b.charAt(f+d+a);f<a&&(e=!1),e?(d+=a-1,e=!1):c+=b.charAt(d)}return c};b+=a.length*4,b+=(c(1,a).length-a.length)*1,b+=(c(2,a).length-a.length)*1,b+=(c(3,a).length-a.length)*1,b+=(c(4,a).length-a.length)*1,a.match(/(.*[0-9].*[0-9].*[0-9])/)&&(b+=5),a.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)&&(b+=5),a.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(b+=10),a.match(/([a-zA-Z])/)&&a.match(/([0-9])/)&&(b+=15),a.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&a.match(/([0-9])/)&&(b+=15),a.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&a.match(/([a-zA-Z])/)&&(b+=15);if(a.match(/^\w+$/)||a.match(/^\d+$/))b-=10;return b<0&&(b=0),b>100&&(b=100),b<34?0:b<68?1:2},strengthDisplay:function(b,c){var d={fontSize:"12pt",padding:"4px",weak:"Weak",good:"Good",strong:"Strong"};c&&a.extend(d,c),b.bind("keyup",function(){var b=typeof d.parent=="undefined"?a(this).parent():a(d.parent),c=b.find(".strength-meter");c.length==0&&(c=a("<span></span>"),c.addClass("strength-meter").appendTo(b));var e=a.formUtils.validators.validate_strength.calculatePasswordStrength(a(this).val()),f={background:"pink",color:"#FF0000",fontWeight:"bold",border:"red solid 1px",borderWidth:"0px 0px 4px",display:"inline-block",fontSize:d.fontSize,padding:d.padding},g=d.weak;e==1?(f.background="lightyellow",f.borderColor="yellow",f.color="goldenrod",g=d.good):e==2&&(f.background="lightgreen",f.borderColor="darkgreen",f.color="darkgreen",g=d.strong),c.css(f).text(g)})}}),a.formUtils.addValidator({oldKeyupEvent:!1,oldSubmitEvent:!1,name:"validate_backend",validate:function(b,c,d,e,f){if(c.attr("data-validation-backend-valid"))return!0;if(c.attr("data-validation-backend-invalid"))return!1;var g=this;this.oldSubmitEvent===!1&&(this.oldKeyupEvent=c.get(0).keyup,this.oldSubmitEvent=f.get(0).onsubmit,this.oldSubmitEvent?f.get(0).onsubmit=function(){return!1}:(a.each(f.data("events").submit,function(a,b){return g.oldSubmitEvent=b.handler,!1}),f.unbind("submit"))),f.unbind("submit").addClass("validating-backend").get(0).onsubmit=function(){return!1};var h=document.location.href;return c.attr("data-validation-backend-url")?h=c.attr("data-validation-backend-url"):"backendUrl"in d&&(h=d.backendUrl),a.ajax({url:h,type:"POST",cache:!1,data:"validate="+b,dataType:"json",success:function(b){b.success?c.attr("data-validation-backend-valid","true"):(c.attr("data-validation-backend-invalid","true"),b.message?c.attr("data-error-message",b.message):c.removeAttr("data-error-message")),f.removeClass("validating-backend").get(0).onsubmit=function(){},f.bind("submit",g.oldSubmitEvent),c.bind("keyup",function(){a(this).removeAttr("data-validation-backend-valid").removeAttr("data-validation-backend-invalid").removeAttr("data-error-message"),g.oldKeyupEvent=="function"&&g.oldKeyupEvent()}),f.trigger("submit")}}),a.formUtils.haltValidation=!0,!1},errorMessage:"",errorMessageKey:"badBackend"}),a.fn.displayPasswordStrength=function(b){return new a.formUtils.validators.validate_strength.strengthDisplay(a(this),b),this}})(jQuery);